---
title: "模块和包"
weight: 8
bookhidden: false
---

# 模块和包

模块和包是 Python 中组织代码的方式。模块是包含 Python 代码的文件，包是包含多个模块的目录。

## 模块（Module）

### 什么是模块？

模块是一个包含 Python 代码的文件，通常以 `.py` 为扩展名。

```python
# 文件：math_utils.py
def add(a, b):
    return a + b

def multiply(a, b):
    return a * b

PI = 3.14159
```

### 导入模块

```python
# 导入整个模块
import math_utils
result = math_utils.add(2, 3)

# 导入并重命名
import math_utils as mu
result = mu.add(2, 3)

# 从模块导入特定函数
from math_utils import add, multiply
result = add(2, 3)

# 导入所有（不推荐）
from math_utils import *
result = add(2, 3)
```

### 模块搜索路径

Python 按以下顺序搜索模块：

1. 当前目录
2. PYTHONPATH 环境变量指定的目录
3. Python 标准库目录
4. site-packages 目录

```python
import sys
print(sys.path)  # 查看模块搜索路径
```

## 包（Package）

### 什么是包？

包是一个包含 `__init__.py` 文件的目录，可以包含多个模块。

```
mypackage/
    __init__.py
    module1.py
    module2.py
    subpackage/
        __init__.py
        module3.py
```

### `__init__.py` 文件

`__init__.py` 文件使目录成为包，可以包含初始化代码。

```python
# mypackage/__init__.py
from .module1 import function1
from .module2 import function2

__all__ = ['function1', 'function2']  # 定义 from package import * 时导入的内容
```

### 导入包

```python
# 导入包
import mypackage
mypackage.function1()

# 从包导入模块
from mypackage import module1
module1.function1()

# 从包导入函数
from mypackage.module1 import function1
function1()

# 从子包导入
from mypackage.subpackage import module3
```

## 标准库模块

Python 提供了丰富的标准库模块。

### os 模块

```python
import os

# 获取当前工作目录
current_dir = os.getcwd()

# 改变工作目录
os.chdir("/path/to/directory")

# 列出目录内容
files = os.listdir(".")

# 创建目录
os.makedirs("new_directory", exist_ok=True)

# 删除文件
os.remove("file.txt")

# 环境变量
home = os.environ.get("HOME")
```

### sys 模块

```python
import sys

# 命令行参数
args = sys.argv

# 退出程序
sys.exit(0)

# Python 版本
print(sys.version)

# 模块搜索路径
print(sys.path)

# 标准输入输出
sys.stdout.write("Hello\n")
user_input = sys.stdin.readline()
```

### datetime 模块

```python
from datetime import datetime, date, timedelta

# 当前时间
now = datetime.now()
print(now)

# 创建日期时间
dt = datetime(2024, 1, 1, 12, 30, 0)

# 格式化日期时间
formatted = now.strftime("%Y-%m-%d %H:%M:%S")
print(formatted)

# 解析字符串
dt = datetime.strptime("2024-01-01", "%Y-%m-%d")

# 日期运算
today = date.today()
tomorrow = today + timedelta(days=1)
```

### json 模块

```python
import json

# 将Python对象转换为JSON字符串
data = {"name": "Alice", "age": 30}
json_str = json.dumps(data)
print(json_str)  # '{"name": "Alice", "age": 30}'

# 将JSON字符串转换为Python对象
data = json.loads('{"name": "Alice", "age": 30}')
print(data["name"])  # Alice

# 读写JSON文件
with open("data.json", "w") as f:
    json.dump(data, f)

with open("data.json", "r") as f:
    data = json.load(f)
```

### random 模块

```python
import random

# 随机整数
num = random.randint(1, 10)

# 随机浮点数
num = random.random()  # 0.0 到 1.0

# 随机选择
choice = random.choice([1, 2, 3, 4, 5])

# 随机打乱列表
numbers = [1, 2, 3, 4, 5]
random.shuffle(numbers)

# 随机采样
sample = random.sample([1, 2, 3, 4, 5], 3)
```

### re 模块（正则表达式）

```python
import re

# 匹配
pattern = r"\d+"
text = "我有3个苹果和5个橙子"
matches = re.findall(pattern, text)
print(matches)  # ['3', '5']

# 搜索
match = re.search(r"\d+", text)
if match:
    print(match.group())  # 3

# 替换
new_text = re.sub(r"\d+", "X", text)
print(new_text)  # 我有X个苹果和X个橙子

# 编译正则表达式（提高性能）
pattern = re.compile(r"\d+")
matches = pattern.findall(text)
```

### collections 模块

```python
from collections import Counter, defaultdict, deque

# Counter - 计数器
counter = Counter([1, 2, 2, 3, 3, 3])
print(counter)  # Counter({3: 3, 2: 2, 1: 1})

# defaultdict - 默认字典
dd = defaultdict(list)
dd["key"].append("value")  # 自动创建空列表

# deque - 双端队列
dq = deque([1, 2, 3])
dq.appendleft(0)  # 左侧添加
dq.append(4)      # 右侧添加
```

### itertools 模块

```python
from itertools import combinations, permutations, product

# 组合
combs = list(combinations([1, 2, 3], 2))
print(combs)  # [(1, 2), (1, 3), (2, 3)]

# 排列
perms = list(permutations([1, 2, 3], 2))
print(perms)  # [(1, 2), (1, 3), (2, 1), (2, 3), (3, 1), (3, 2)]

# 笛卡尔积
prods = list(product([1, 2], [3, 4]))
print(prods)  # [(1, 3), (1, 4), (2, 3), (2, 4)]
```

## 模块的特殊属性

```python
# __name__ - 模块名称
# 当模块被直接运行时，__name__ 为 "__main__"
# 当模块被导入时，__name__ 为模块名

# 文件：my_module.py
def hello():
    print("Hello from module")

if __name__ == "__main__":
    # 只有直接运行此文件时才会执行
    hello()

# __file__ - 模块文件路径
import my_module
print(my_module.__file__)

# __doc__ - 模块文档字符串
print(my_module.__doc__)
```

## 相对导入和绝对导入

### 绝对导入

```python
# 从包根目录开始的完整路径
from mypackage.module1 import function1
from mypackage.subpackage.module3 import function3
```

### 相对导入

```python
# 在包内部使用相对导入
# 文件：mypackage/module1.py
from .module2 import function2  # 同一包
from ..subpackage.module3 import function3  # 上级包的子包
```

## 第三方包管理

### pip 安装

```bash
# 安装包
pip install package_name

# 安装特定版本
pip install package_name==1.0.0

# 从requirements.txt安装
pip install -r requirements.txt

# 卸载包
pip uninstall package_name

# 列出已安装的包
pip list

# 查看包信息
pip show package_name
```

### requirements.txt

```txt
# requirements.txt
requests==2.28.0
numpy>=1.20.0
pandas<2.0.0
```

## 虚拟环境

使用虚拟环境可以隔离不同项目的依赖。

```bash
# 创建虚拟环境
python -m venv myenv

# 激活虚拟环境
# Windows
myenv\Scripts\activate

# macOS/Linux
source myenv/bin/activate

# 停用虚拟环境
deactivate
```

## 模块导入最佳实践

1. **导入顺序**：标准库 → 第三方库 → 本地模块
2. **使用绝对导入**（除非在包内部）
3. **避免 `from module import *`**
4. **使用 `__all__` 定义公共接口**
5. **合理使用 `if __name__ == "__main__"`**

```python
# 推荐的导入顺序
import os
import sys
from datetime import datetime

import requests
import numpy as np

from mypackage import module1
from mypackage.module2 import function2
```

## 下一步

掌握了模块和包后，可以学习：

1. [文件操作](9-文件操作.md) - 学习文件读写操作
2. [高级特性](10-高级特性.md) - 学习生成器、迭代器等高级特性
